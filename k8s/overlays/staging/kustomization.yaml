apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: staging

resources:
  - namespace.yaml
  - ingress.yaml
  - ../../base/api
  - ../../base/workers

commonLabels:
  env: staging

configMapGenerator:
  - name: launchsin-config
    literals:
      - supabase-url=https://staging.supabase.co
      - node-env=staging

# Secrets should be managed via SealedSecrets or ExternalSecrets in production.
# Here we expect 'launchsin-secrets' to exist in the namespace.

# Patch to scale down for staging to save costs
patches:
  - target:
      kind: Deployment
      name: launchsin-api
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
  - target:
      kind: Deployment
      name: launchsin-workers
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
